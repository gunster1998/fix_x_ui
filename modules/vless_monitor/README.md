# vless_monitor

Модуль для [Solo_bot](https://github.com/Nurullaev/NurVPN) / Chill_bot.

## Проблема

Стандартный мониторинг бота проверяет серверы **изнутри** (ICMP ping / TCP:443 от самого VPS).
Но VLESS-порт может быть недоступен с клиентской стороны (блокировки ТСПУ, firewall), при этом VPS пингуется нормально.

## Решение

Модуль каждые 5 минут подключается по SSH к **домашнему серверу** (обычный клиентский интернет) и оттуда делает TCP-проверку VLESS-портов всех включённых серверов.

- При недоступности (≥ FAIL_THRESHOLD провалов подряд) — уведомление администраторам
- При восстановлении — уведомление о recovery

## Установка

1. Установить зависимость в venv бота:
   ```
   pip install asyncssh
   ```

2. Скопировать папку `vless_monitor` в `modules/` бота:
   ```
   modules/
     vless_monitor/
       __init__.py
       router.py
       settings.py
   ```

3. Перезапустить бота — модуль подхватится автоматически.

## Настройка

`settings.py`:

```python
# Домашний сервер (обычный интернет) для проверки
HOME_SSH_HOST = "95.165.78.218"
HOME_SSH_PORT = 2222
HOME_SSH_USER = "gunster1998"
HOME_SSH_PASS = "61190"

# Интервал проверки в секундах
CHECK_INTERVAL = 300  # 5 минут

# Сколько провалов подряд до уведомления
FAIL_THRESHOLD = 2

# Таймаут TCP соединения
CONNECT_TIMEOUT = 10
```

## Включение / отключение

Через админку бота: **Управление модулями → vless_monitor**.

## Примечания

- Проверки на домашнем сервере выполняются **параллельно** (ThreadPoolExecutor) — все серверы за один timeout
- Логи на уровне `WARNING` — видны при `LOGGING_LEVEL = "WARNING"` в config.py
- Совместим с Solo_bot / Chill_bot на базе aiogram 3.x
